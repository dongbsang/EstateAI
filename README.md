# PropLens 🏠

> **부동산 매물 자동 검색 및 사전 검증 시스템**  
> Rule-based + LLM Hybrid Real Estate Analyzer

## 프로젝트 개요

공인중개사 방문 전, 매물을 **자동으로** 수집하고 분석하여 **조건 필터링, 리스크 체크, 질문 생성, 리포트 출력**을 제공하는 도구입니다.

### 핵심 기능

| 기능 | 설명 | 상태 |
|------|------|------|
| 🔍 **자동 매물 수집** | 네이버 부동산에서 조건에 맞는 매물 크롤링 | ✅ 완료 |
| 🏠 **주택 유형 선택** | 아파트/오피스텔/빌라 선택 검색 | ✅ 완료 |
| 💰 **실거래가 검증** | 국토부 API로 전세가율 분석 | ✅ 완료 |
| 🚇 **통근 시간 계산** | ODsay API로 대중교통 시간 분석 | ✅ 완료 |
| ⚡ **조건 필터링** | 예산/면적/세대수 등 규칙 기반 필터 | ✅ 완료 |
| ⚠️ **리스크 분석** | 위험 신호 패턴 매칭 (깡통전세 등) | ✅ 완료 |
| ❓ **질문 생성** | 중개사 질문 자동 생성 | ✅ 완료 |
| 📊 **리포트 출력** | 추천 순위 및 상세 분석 | ✅ 완료 |
| 📝 **직접 평가** | 특정 단지/매물 직접 선택하여 평가 | ✅ 완료 |

## 핵심 원칙

1. **LLM은 보조 엔진** - 판단/필터/점수는 규칙 기반 코드로 처리
2. **llama.cpp (GGUF) 내장형 배포 예정** - 외부 유료 API 의존 금지
3. **설명 가능한 결과** - 왜 탈락/추천인지 근거 필수 제공
4. **작게 만들고 빠르게 검증** - MVP → 확장 방식

## 빠른 시작

### 1. 설치

```bash
# 클론
git clone https://github.com/your-repo/PropLens.git
cd PropLens

# 가상환경
python -m venv venv
venv\Scripts\activate  # Windows
source venv/bin/activate  # Linux/Mac

# 의존성 설치
pip install -r requirements.txt

# 환경변수 설정
cp .env.example .env
```

### 2. 환경변수 설정 (.env)

```ini
# 선택 - 없어도 기본 기능(매물 검색, 필터링, 리스크) 동작
DATA_GO_KR_API_KEY=your_api_key  # 국토부 실거래가 (전세가율 분석)
ODSAY_API_KEY=your_api_key       # 출퇴근 시간 계산
```

### 3. 실행

```bash
# Streamlit UI 실행
streamlit run ui/app.py

# 브라우저에서 http://localhost:8501 접속
```

## 사용 방법

### 🔍 자동 검색 탭

조건에 맞는 매물을 자동으로 수집하고 분석합니다.

1. **사이드바에서 조건 설정**
   - 거래 유형: 전세/월세/매매
   - 예산: 최대 보증금 (만원)
   - 지역: 서울 25개 구 / 경기도 주요 지역 (다중 선택)
   - 주택 유형: 아파트/오피스텔/빌라 (다중 선택)
   - 면적: 최소 전용면적 (㎡)
   - 세대수: 최소 세대수
   - 출퇴근: 목적지 및 최대 시간 (선택, ODsay API 필요)

2. **"검색 시작" 클릭**
   - 캐시가 없으면 1-2분 소요
   - 동일 조건은 24시간 캐시

3. **결과 확인**
   - 추천 매물: 점수순 정렬
   - 상세 정보: 전세가율, 리스크, 중개사 질문

### 📝 직접 평가 탭

특정 매물을 직접 선택하여 평가합니다.

- **목록에서 선택**: 지역 → 단지 → 매물 순으로 선택
- **직접 입력**: 단지명을 직접 입력하여 검색

### 캐시 관리

```bash
# CLI
python scripts/cache_cli.py status   # 상태 확인
python scripts/cache_cli.py clear    # 전체 삭제

# UI
사이드바 하단 "📦 캐시 관리" 섹션에서 관리
```

## 파이프라인 구조

```
UserInput (검색 조건)
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ Phase 1: 수집 & 보강                                         │
│ SearchAgent → EnrichAgent (실거래가) → NormalizeAgent        │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ Phase 2: 필터링 (규칙 기반)                                  │
│ FilterAgent (예산/면적/세대수/주택유형)                       │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ Phase 3: 통근 시간 (선택, 필터 통과 매물만)                   │
│ CommuteAgent (ODsay API)                                    │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│ Phase 4: 분석 & 리포트                                       │
│ ScoreAgent → RiskAgent → QuestionAgent → ReportAgent        │
└─────────────────────────────────────────────────────────────┘
    │
    ▼
Report (최종 결과)
```

## 폴더 구조

```
PropLens/
├── app/
│   ├── agents/           # Agent 구현 (9개)
│   ├── api/              # FastAPI 라우터
│   ├── data_sources/     # 외부 API 클라이언트
│   ├── domain/           # 규칙 기반 로직 (필터/점수/리스크)
│   ├── pipeline/         # 파이프라인 오케스트레이션
│   ├── schemas/          # Pydantic 모델
│   └── config.py         # 설정 관리
├── ui/                   # Streamlit UI
├── scripts/              # CLI 도구
├── models/               # GGUF 모델 (향후)
└── data/                 # 캐시 데이터
```

## API 키 발급 (선택)

### 국토부 실거래가 API
- [공공데이터포털](https://www.data.go.kr) 회원가입
- "국토교통부_아파트 전월세 실거래가" API 신청
- 승인 후 API 키 발급

### ODsay 대중교통 API
- [ODsay Lab](https://lab.odsay.com) 회원가입
- API 키 발급 (무료 1,000건/일)

## 지원 지역

### 서울 (25개 구)
강남구, 강동구, 강북구, 강서구, 관악구, 광진구, 구로구, 금천구, 노원구, 도봉구, 동대문구, 동작구, 마포구, 서대문구, 서초구, 성동구, 성북구, 송파구, 양천구, 영등포구, 용산구, 은평구, 종로구, 중구, 중랑구

### 경기도 (주요 지역)
성남 분당구, 수원 영통구, 용인 수지구/기흥구, 고양 일산동구/일산서구, 안양 동안구, 광명, 부천, 과천, 화성, 김포, 하남, 구리, 남양주 등

## 주의사항

⚠️ **네이버 부동산 API 관련**
- 과도한 요청 시 차단될 수 있음 (자동 2-3초 딜레이 적용)
- 차단 시 30분 후 재시도 필요
- 24시간 캐시로 중복 요청 방지

⚠️ **상업적 용도**
- 크롤링 관련 법적 검토 필요

## 라이선스

MIT License

## 상세 문서

기술적 세부사항은 [README_DETAIL.md](./README_DETAIL.md) 참조
